blueprint:
  name: Trigger Light Control
  description: Control multiple lights with multiple triggers using Z-Wave JS.
  domain: automation
  input:
    triggers:
      name: Triggers
      description: Select the triggers for on/off and dim control.
      selector:
        select:
          options:
            - On
            - Off
            - Dim
          multiple: true
    target_lights:
      name: Target Lights
      description: Select multiple target lights to control.
      selector:
        entity:
          domain: light
          multiple: true
    dim_brightness:
      name: Dim Brightness
      description: Set the dim brightness level.
      default: 50
      selector:
        number:
          min: 1
          max: 100
          unit_of_measurement: "%"
          mode: slider
    transition_time:
      name: Transition Time
      description: Set the transition speed (in seconds) for light changes.
      default: 1.0
      selector:
        number:
          min: 0
          max: 10
          unit_of_measurement: "s"
          mode: slider
          step: 0.1

mode: single
max_exceeded: silent
trigger:
  - platform: event
    event_type: zwave_js_value_notification
    event_data:
      trigger: 
        # This listens for any of the selected triggers
        - trigger for trigger in !input triggers

variables:
  trigger: '{{ trigger.event.data.value }}'
  target_lights: !input target_lights
  dim_brightness: !input dim_brightness
  transition_time: !input transition_time

condition:
  # Ensure the event matches one of the selected triggers.
  - condition: template
    value_template: >
      {{ trigger in ['On', 'Off', 'Dim'] }}

action:
  - choose:
      # Single button press toggles light brightness between 100% and 0%
      - conditions:
          - condition: template
            value
