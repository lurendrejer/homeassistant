blueprint:
  name: Multi-Trigger Light Control
  description: Control light based on multiple triggers for on/off and dim actions.
  domain: automation
  input:
    on_off_triggers:
      name: On/Off Triggers
      description: Select devices and triggers for turning lights on or off.
      selector:
        device_trigger:
          domain: light
          type: power
          multiple: true
    dim_triggers:
      name: Dim Triggers
      description: Select devices and triggers for dimming lights.
      selector:
        device_trigger:
          domain: light
          type: brightness
          multiple: true
    target_light:
      name: Target Light
      description: Select the light to control.
      selector:
        entity:
          domain: light
    dim_brightness:
      name: Dim Brightness Level
      description: Brightness level to set when dimming.
      default: 50
      selector:
        number:
          min: 1
          max: 100
          unit_of_measurement: "%"
          mode: slider
    transition_time:
      name: Transition Time
      description: Set the transition speed (in seconds) for light changes.
      default: 1.0
      selector:
        number:
          min: 0
          max: 10
          unit_of_measurement: "s"
          mode: slider
          step: 0.1

mode: single
max_exceeded: silent

trigger:
  # Trigger for the on/off actions
  - platform: device
    device_id: !input on_off_triggers
    domain: light
    type: power
    subtype: turned_on
  - platform: device
    device_id: !input on_off_triggers
    domain: light
    type: power
    subtype: turned_off
  # Trigger for the dimming actions
  - platform: device
    device_id: !input dim_triggers
    domain: light
    type: brightness
    subtype: above
    value: 0
  - platform: device
    device_id: !input dim_triggers
    domain: light
    type: brightness
    subtype: below
    value: 100

variables:
  transition_time: !input transition_time
  dim_brightness: !input dim_brightness

action:
  # Action for turning the light on/off
  - choose:
      - conditions:
          - condition: trigger
            id: "on_off_triggers"
            type: power
            subtype: turned_on
        sequence:
          - service: light.turn_on
            data:
              entity_id: !input target_light
              brightness_pct: 100
              transition: "{{ transition_time }}"
      - conditions:
          - condition: trigger
            id: "on_off_triggers"
            type: power
            subtype: turned_off
        sequence:
          - service: light.turn_off
            data:
              entity_id: !input target_light
              transition: "{{ transition_time }}"

  # Action for dimming the light
  - choose:
      - conditions:
          - condition: trigger
            id: "dim_triggers"
            type: brightness
            subtype: above
        sequence:
          - service: light.turn_on
            data:
              entity_id: !input target_light
              brightness_pct: "{{ dim_brightness }}"
              transition: "{{ transition_time }}"
      - conditions:
          - condition: trigger
            id: "dim_triggers"
            type: brightness
            subtype: below
        sequence:
          - service: light.turn_on
            data:
              entity_id: !input target_light
              brightness_pct: 0
              transition: "{{ transition_time }}"
  default:
    - service: system_log.write
      data:
        level: warning
        message: "An unsupported trigger was activated."
